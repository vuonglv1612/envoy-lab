[SERVICE]
    Flush        5
    Daemon       off
    Log_Level    info
    Parsers_File parsers.conf
    HTTP_Server  On
    HTTP_Listen  0.0.0.0
    HTTP_Port    2020

[INPUT]
    Name              tail
    Tag               envoy.access
    Path              /tmp/access.log
    Parser            envoy_access_log
    Refresh_Interval  1
    Read_from_Head    true
    Skip_Long_Lines   On
    Skip_Empty_Lines  On


[FILTER]
    Name         modify
    Match        envoy.access
    Add          service envoy-proxy
    Add          environment production
    Add          log_type access_log
    Add          source travelhub

[FILTER]
    Name         modify
    Match        envoy.access
    Add          service envoy-proxy
    Add          environment production
    Add          log_type access_log
    Add          source travelhub
    Rename       timestamp @timestamp
    Rename       method http_method
    Rename       path http_path
    Rename       response_code http_status
    Rename       bytes_received bytes_in
    Rename       bytes_sent bytes_out
    Rename       duration response_time_ms
    Rename       upstream_duration upstream_time_ms
    Rename       remote_address client_ip
    Rename       user_agent user_agent
    Rename       request_id request_id
    Rename       supplier supplier_id
    Rename       connection_code connection_code
    Rename       buyer_profile_id buyer_profile_id

[OUTPUT]
    Name                     loki
    Match                    envoy.access
    Host                     loki
    Port                     3100
    Labels                   job=envoy-proxy,service=travelhub,environment=production,log_type=access_log
    Auto_Kubernetes_Labels   off
    Remove_Keys              service,environment,log_type,source
    Line_Format              json
    Label_Keys               $supplier_id,$connection_code,$buyer_profile_id,$http_method,$http_status